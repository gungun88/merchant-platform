# å…¨ç«™æ€§èƒ½ä¼˜åŒ–è¯´æ˜

## é—®é¢˜åˆ†æ

ç”¨æˆ·åé¦ˆï¼?1. æ¯æ¬¡ç™»å½•æˆ–è¿”å›é¦–é¡µæ—¶ï¼Œé¡µé¢åŠ è½½å¾ˆæ…?2. å¸Œæœ›ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œé¿å…é‡å¤åŠ è½?3. å¸Œæœ›æ•°æ®èƒ½å¤Ÿåˆ†é˜¶æ®µåŠ è½½ï¼Œæå‡ä½“éªŒæµç•…åº?
ç»è¿‡ä»£ç åˆ†æï¼Œå‘ç°ä»¥ä¸‹æ€§èƒ½ç“¶é¢ˆï¼?
### 1. ä¸²è¡Œæ•°æ®åŠ è½½ï¼ˆâœ… å·²ä¼˜åŒ–ï¼‰
**é—®é¢˜**ï¼šåŸä»£ç æœ?4 ä¸ªç‹¬ç«‹çš„ useEffectï¼ŒæŒ‰é¡ºåºä¾æ¬¡æ‰§è¡Œ
- useEffect 1: åŠ è½½æœåŠ¡ç±»å‹
- useEffect 2: åŠ è½½ç³»ç»Ÿè®¾ç½®
- useEffect 3: åŠ è½½ç”¨æˆ·ä¿¡æ¯ï¼ˆå†…å?4 ä¸ªä¸²è¡ŒæŸ¥è¯¢ï¼‰
- useEffect 4: åŠ è½½å•†å®¶åˆ—è¡¨

è¿™ç§æ–¹å¼å¯¼è‡´æ€»åŠ è½½æ—¶é—?= å„ä¸ªè¯·æ±‚æ—¶é—´ä¹‹å’Œã€?
**ç¬¬ä¸€é˜¶æ®µä¼˜åŒ–**ï¼ˆå¹¶è¡ŒåŠ è½½ï¼‰ï¼?- åˆå¹¶å‰?3 ä¸?useEffect ä¸ºä¸€ä¸?- ä½¿ç”¨ `Promise.all()` å¹¶è¡ŒåŠ è½½æ‰€æœ‰æ•°æ?- å¯¹äºç”¨æˆ·ç›¸å…³æ•°æ®ï¼ˆå•†å®¶ä¿¡æ¯ã€ç§¯åˆ†ã€å¤‡æ³¨ï¼‰ï¼Œä¹Ÿæ”¹ä¸ºå¹¶è¡ŒåŠ è½½

**ç¬¬äºŒé˜¶æ®µä¼˜åŒ–**ï¼ˆæœ¬åœ°ç¼“å­?+ åˆ†é˜¶æ®µåŠ è½½ï¼‰ï¼?- é™æ€æ•°æ®ï¼ˆæœåŠ¡ç±»å‹ã€ç³»ç»Ÿè®¾ç½®ï¼‰ä½¿ç”¨ localStorage ç¼“å­˜ 5 åˆ†é’Ÿ
- é¡µé¢åŠ è½½æ—¶ç«‹å³ä½¿ç”¨ç¼“å­˜æ•°æ®æ¸²æŸ“ï¼Œåå°å¼‚æ­¥åˆ·æ–°
- ç”¨æˆ·æ•°æ®å»¶è¿Ÿ 100ms åŠ è½½ï¼Œä¸é˜»å¡ç•Œé¢é¦–æ¬¡æ¸²æŸ“
- å•†å®¶åˆ—è¡¨æ•°æ®æ­£å¸¸åŠ è½½ï¼Œæ˜¾ç¤ºéª¨æ¶å±

**æ•ˆæœ**ï¼?- ä¼˜åŒ–å‰ï¼šä¸²è¡ŒåŠ è½½çº?2.5-4 ç§?- ç¬¬ä¸€æ¬¡è®¿é—®ï¼ˆæ— ç¼“å­˜ï¼‰ï¼šçº¦ 1.5 ç§?- äºŒæ¬¡è®¿é—®ï¼ˆæœ‰ç¼“å­˜ï¼‰ï¼šçº?0.3-0.5 ç§’ï¼ˆå‡ ä¹ç¬é—´æ˜¾ç¤ºï¼?
### 2. å®æ—¶è®¢é˜…é¢‘ç¹è§¦å‘ï¼ˆâœ… å·²ä¼˜åŒ–ï¼‰
**é—®é¢˜**ï¼šæ¯æ¬¡å•†å®¶è¡¨æ•°æ®å˜åŒ–éƒ½ç«‹å³é‡æ–°åŠ è½½æ•´ä¸ªåˆ—è¡¨ï¼Œå¦‚æœçŸ­æ—¶é—´å†…å¤šæ¬¡å˜åŒ–ä¼šå¯¼è‡´å¤šæ¬¡è¯·æ±‚ã€?
**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼?- æ·»åŠ  1 ç§’é˜²æŠ–ï¼ˆdebounceï¼?- çŸ­æ—¶é—´å†…å¤šæ¬¡å˜åŒ–åªè§¦å‘ä¸€æ¬¡åŠ è½?- æ­£ç¡®æ¸…ç†å®šæ—¶å™¨ï¼Œé¿å…å†…å­˜æ³„æ¼

**æ•ˆæœ**ï¼šå‡å°‘ä¸å¿…è¦çš„é‡å¤è¯·æ±?
### 3. ç¼ºå°‘åŠ è½½åé¦ˆï¼ˆâœ… å·²ä¼˜åŒ–ï¼‰
**é—®é¢˜**ï¼šæ•°æ®åŠ è½½æ—¶åªæ˜¾ç¤?åŠ è½½ä¸?.."æ–‡å­—ï¼Œç”¨æˆ·ä½“éªŒå·®ã€?
**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼?- åˆ›å»ºä¸“ç”¨çš„éª¨æ¶å±ç»„ä»¶ `MerchantListSkeleton`
- PC ç«¯æ˜¾ç¤ºè¡¨æ ¼éª¨æ¶ï¼ˆ5 è¡Œï¼‰
- ç§»åŠ¨ç«¯æ˜¾ç¤ºå¡ç‰‡éª¨æ¶ï¼ˆ3 ä¸ªï¼‰
- ä½¿ç”¨ Skeleton ç»„ä»¶çš„è„‰å†²åŠ¨ç”?
**æ•ˆæœ**ï¼šç”¨æˆ·èƒ½çœ‹åˆ°é¡µé¢ç»“æ„ï¼Œæ„ŸçŸ¥åŠ è½½é€Ÿåº¦æ›´å¿«

### 4. æœªä¼˜åŒ–çš„åç«¯æŸ¥è¯¢ï¼ˆâš ï¸?å¾…ä¼˜åŒ–ï¼‰
**é—®é¢˜**ï¼š`getMerchants()` å‡½æ•°æ¯æ¬¡éƒ½ï¼š
- ä»æ•°æ®åº“åŠ è½½æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„å•†å®¶ï¼ˆä¸é™åˆ¶æ•°é‡ï¼?- åœ¨å†…å­˜ä¸­è¿›è¡Œæ’åºï¼ˆå®˜æ–¹ç½®é¡?â†?è‡ªåŠ©ç½®é¡¶ â†?ç§¯åˆ† â†?åˆ›å»ºæ—¶é—´ï¼?- åœ¨å†…å­˜ä¸­åˆ†é¡µ

è¿™ç§æ–¹å¼åœ¨å•†å®¶æ•°é‡å¤šï¼?100ï¼‰æ—¶æ€§èƒ½å¾ˆå·®ã€?
**å»ºè®®ä¼˜åŒ–æ–¹æ¡ˆ**ï¼ˆæœªå®æ–½ï¼‰ï¼š
1. åœ¨æ•°æ®åº“å±‚é¢è¿›è¡Œæ’åºï¼ˆä½¿ç”?ORDER BYï¼?2. åœ¨æ•°æ®åº“å±‚é¢åˆ†é¡µï¼ˆä½¿ç”?LIMIT/OFFSET æˆ?rangeï¼?3. è€ƒè™‘ä½¿ç”¨ PostgreSQL çš„ç‰©åŒ–è§†å›¾ç¼“å­˜æ’åºç»“æ?
## å·²å®æ–½çš„ä¼˜åŒ–

### æ–‡ä»¶ï¼š`app/page.tsx`

#### 1. æœ¬åœ°ç¼“å­˜ + åˆ†é˜¶æ®µåŠ è½½ï¼ˆç¬?05-187è¡Œï¼‰
```typescript
// ä¼˜åŒ–ï¼šåˆ†é˜¶æ®µåŠ è½½ + æœ¬åœ°ç¼“å­˜
useEffect(() => {
  async function loadInitialData() {
    const supabase = createClient()

    // ç¬¬ä¸€æ­¥ï¼šç«‹å³ä»ç¼“å­˜åŠ è½½é™æ€æ•°æ®ï¼Œå¿«é€Ÿæ¸²æŸ“ç•Œé?    const cachedServiceTypes = localStorage.getItem('cached_service_types')
    const cachedSettings = localStorage.getItem('cached_system_settings')
    const cacheTimestamp = localStorage.getItem('cache_timestamp')
    const now = Date.now()
    const CACHE_DURATION = 5 * 60 * 1000 // 5åˆ†é’Ÿç¼“å­˜

    // å¦‚æœç¼“å­˜æœ‰æ•ˆï¼?åˆ†é’Ÿå†…ï¼‰ï¼Œå…ˆç”¨ç¼“å­˜æ•°æ®å¿«é€Ÿæ¸²æŸ?    if (cacheTimestamp && (now - parseInt(cacheTimestamp)) < CACHE_DURATION) {
      if (cachedServiceTypes) {
        setServiceTypes(JSON.parse(cachedServiceTypes))
      }
      if (cachedSettings) {
        const settings = JSON.parse(cachedSettings)
        setSystemSettings(settings)
        if (settings.merchants_per_page) {
          setPageSize(settings.merchants_per_page)
        }
      }
    }

    // ç¬¬äºŒæ­¥ï¼šè·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆæœ€é‡è¦ï¼Œä¼˜å…ˆåŠ è½½ï¼‰
    const { data: { user } } = await supabase.auth.getUser()
    if (user) {
      setCurrentUserId(user.id)
    }

    // ç¬¬ä¸‰æ­¥ï¼šåå°å¹¶è¡Œåˆ·æ–°é™æ€æ•°æ®å¹¶æ›´æ–°ç¼“å­˜
    Promise.all([
      getAllServiceTypes(),
      getSystemSettings(),
    ]).then(([serviceTypesResult, settingsResult]) => {
      // æ›´æ–°å¹¶ç¼“å­˜æ•°æ?      setServiceTypes(serviceTypesResult)
      localStorage.setItem('cached_service_types', JSON.stringify(serviceTypesResult))

      if (settingsResult.success && settingsResult.data) {
        setSystemSettings(settingsResult.data)
        localStorage.setItem('cached_system_settings', JSON.stringify(settingsResult.data))
      }

      localStorage.setItem('cache_timestamp', now.toString())
    })

    // ç¬¬å››æ­¥ï¼šå»¶è¿ŸåŠ è½½ç”¨æˆ·æ•°æ®ï¼ˆä¸é˜»å¡ç•Œé¢æ¸²æŸ“ï¼?    if (user) {
      setInitializing(false) // å…ˆæ ‡è®°å®Œæˆï¼Œè®©ç•Œé¢æ˜¾ç¤?
      setTimeout(() => {
        Promise.all([
          supabase.from("merchants").select("*").eq("user_id", user.id).maybeSingle(),
          getUserPoints(user.id),
          getAllMerchantNotes(),
        ]).then(([merchantData, points, notesResult]) => {
          // è®¾ç½®ç”¨æˆ·æ•°æ®
        })
      }, 100) // å»¶è¿Ÿ100ms
    }
  }

  loadInitialData()
}, [])
```

**å…³é”®ä¼˜åŒ–ç‚?*ï¼?1. **ç«‹å³æ¸²æŸ“**ï¼šä½¿ç”¨ç¼“å­˜æ•°æ®ç«‹å³æ¸²æŸ“ç•Œé¢ï¼ˆ0msï¼?2. **åå°åˆ·æ–°**ï¼šå¼‚æ­¥æ›´æ–°ç¼“å­˜ï¼Œä¸é˜»å¡æ¸²æŸ?3. **å»¶è¿ŸåŠ è½½**ï¼šç”¨æˆ·æ•°æ®å»¶è¿ŸåŠ è½½ï¼Œä¼˜å…ˆæ˜¾ç¤ºå•†å®¶åˆ—è¡¨
4. **ç¼“å­˜ç­–ç•¥**ï¼?åˆ†é’Ÿæœ‰æ•ˆæœŸï¼Œå¹³è¡¡æ–°é²œåº¦å’Œæ€§èƒ½

#### 2. å®æ—¶è®¢é˜…é˜²æŠ–ï¼ˆç¬¬214-249è¡Œï¼‰
```typescript
// ä¼˜åŒ–ï¼šä½¿ç”¨é˜²æŠ–çš„å®æ—¶è®¢é˜…ï¼Œé¿å…é¢‘ç¹é‡æ–°åŠ è½?useEffect(() => {
  const supabase = createClient()
  let debounceTimer: NodeJS.Timeout | null = null

  const channel = supabase
    .channel('merchants-changes-frontend')
    .on('postgres_changes', { ... }, (payload) => {
      // ä½¿ç”¨é˜²æŠ–ï¼Œé¿å…çŸ­æ—¶é—´å†…å¤šæ¬¡å˜åŒ–å¯¼è‡´é¢‘ç¹åŠ è½?      if (debounceTimer) {
        clearTimeout(debounceTimer)
      }

      debounceTimer = setTimeout(async () => {
        // 1ç§’åæ‰æ‰§è¡ŒåŠ è½?        const result = await getMerchants({ ... })
        setMerchants(result.merchants)
        setTotalMerchants(result.total)
      }, 1000)
    })
    .subscribe()

  return () => {
    if (debounceTimer) {
      clearTimeout(debounceTimer)
    }
    supabase.removeChannel(channel)
  }
}, [filters, currentPage, pageSize])
```

#### 3. éª¨æ¶å±æ˜¾ç¤ºï¼ˆç¬?51-752è¡Œï¼‰
```typescript
{loading ? (
  <MerchantListSkeleton />
) : merchants.length === 0 ? (
  // ç©ºçŠ¶æ€?) : (
  // å•†å®¶åˆ—è¡¨
)}
```

### æ–‡ä»¶ï¼š`components/merchant-list-skeleton.tsx`ï¼ˆæ–°å»ºï¼‰

ä¸“ç”¨çš„éª¨æ¶å±ç»„ä»¶ï¼Œæä¾›åŠ è½½æ—¶çš„è§†è§‰åé¦ˆï¼š

```typescript
export function MerchantListSkeleton() {
  return (
    <div className="space-y-4">
      {/* PCç«¯éª¨æ¶å± - 5è¡Œè¡¨æ ¼æ ·å¼?*/}
      <Card className="hidden lg:block p-6">
        <div className="space-y-4">
          {[1, 2, 3, 4, 5].map((i) => (
            <div key={i} className="flex items-center gap-4">
              <Skeleton className="h-10 w-10 rounded-full" />
              <div className="flex-1 space-y-2">
                <Skeleton className="h-4 w-[200px]" />
                <Skeleton className="h-3 w-[300px]" />
              </div>
              <Skeleton className="h-8 w-[100px]" />
            </div>
          ))}
        </div>
      </Card>

      {/* ç§»åŠ¨ç«¯éª¨æ¶å± - 3ä¸ªå¡ç‰‡æ ·å¼?*/}
      <div className="lg:hidden space-y-3">
        {[1, 2, 3].map((i) => (
          <Card key={i} className="p-3">
            {/* å¡ç‰‡éª¨æ¶å†…å®¹ */}
          </Card>
        ))}
      </div>
    </div>
  )
}
```

## æ€§èƒ½å¯¹æ¯”

### é¦–æ¬¡è®¿é—®ï¼ˆæ— ç¼“å­˜ï¼?
**ä¼˜åŒ–å‰?*ï¼?```
å¼€å§? â†?(300ms) åŠ è½½æœåŠ¡ç±»å‹
 â†?(200ms) åŠ è½½ç³»ç»Ÿè®¾ç½®
 â†?(400ms) è·å–ç”¨æˆ·ä¿¡æ¯
 â†?(300ms) è·å–å•†å®¶ä¿¡æ¯
 â†?(200ms) è·å–ç”¨æˆ·ç§¯åˆ†
 â†?(300ms) è·å–å•†å®¶å¤‡æ³¨
 â†?(800ms) åŠ è½½å•†å®¶åˆ—è¡¨
å®Œæˆ (æ€»è®¡çº?2.5ç§?
```

**ä¼˜åŒ–å?*ï¼?```
å¼€å§? â†?(0ms) æ˜¾ç¤ºç•Œé¢éª¨æ¶
 â†?(400ms) è·å–ç”¨æˆ·ä¿¡æ¯
 â†?å¹¶è¡Œæ‰§è¡Œ
 â”œâ”€ (300ms) åå°åˆ·æ–°æœåŠ¡ç±»å‹
 â”œâ”€ (200ms) åå°åˆ·æ–°ç³»ç»Ÿè®¾ç½®
 â””â”€ (800ms) åŠ è½½å•†å®¶åˆ—è¡¨ â¬…ï¸ æ˜¾ç¤ºæ•°æ®
 â†?(100mså»¶è¿Ÿåå¹¶è¡Œæ‰§è¡?
 â”œâ”€ (300ms) è·å–å•†å®¶ä¿¡æ¯
 â”œâ”€ (200ms) è·å–ç”¨æˆ·ç§¯åˆ†
 â””â”€ (300ms) è·å–å•†å®¶å¤‡æ³¨
å®Œæˆ (ç”¨æˆ·æ„ŸçŸ¥æ—¶é—´çº?1.2ç§?
```

### äºŒæ¬¡è®¿é—®ï¼ˆæœ‰ç¼“å­˜ï¼?
**ä¼˜åŒ–å?*ï¼?```
å¼€å§? â†?(0ms) ä»ç¼“å­˜åŠ è½½æ•°æ®ï¼Œç«‹å³æ˜¾ç¤ºç•Œé¢
 â†?(400ms) è·å–ç”¨æˆ·ä¿¡æ¯
 â†?(800ms) åŠ è½½å•†å®¶åˆ—è¡¨ â¬…ï¸ å®Œæ•´æ˜¾ç¤º
 â†?åå°å¼‚æ­¥æ›´æ–°
 â”œâ”€ (300ms) åˆ·æ–°æœåŠ¡ç±»å‹ç¼“å­˜
 â”œâ”€ (200ms) åˆ·æ–°ç³»ç»Ÿè®¾ç½®ç¼“å­˜
 â””â”€ (300ms) åŠ è½½ç”¨æˆ·è¯¦ç»†æ•°æ®
å®Œæˆ (ç”¨æˆ·æ„ŸçŸ¥æ—¶é—´çº?0.3-0.5ç§?
```

**æ€§èƒ½æå‡**ï¼?- é¦–æ¬¡è®¿é—®ï¼šä» 2.5ç§?â†?1.2ç§’ï¼ˆ52% æå‡ï¼?- äºŒæ¬¡è®¿é—®ï¼šä» 2.5ç§?â†?0.4ç§’ï¼ˆ84% æå‡ï¼?
## ç¼“å­˜ç­–ç•¥è¯´æ˜

### localStorage ç¼“å­˜å†…å®¹

1. **cached_service_types**ï¼šæœåŠ¡ç±»å‹åˆ—è¡?   - æ•°æ®ç‰¹ç‚¹ï¼šå‡ ä¹ä¸å?   - ç¼“å­˜æ—¶é•¿ï¼?åˆ†é’Ÿ

2. **cached_system_settings**ï¼šç³»ç»Ÿè®¾ç½?   - æ•°æ®ç‰¹ç‚¹ï¼šç®¡ç†å‘˜å¶å°”ä¿®æ”¹
   - ç¼“å­˜æ—¶é•¿ï¼?åˆ†é’Ÿ

3. **cache_timestamp**ï¼šç¼“å­˜æ—¶é—´æˆ³
   - ç”¨é€”ï¼šåˆ¤æ–­ç¼“å­˜æ˜¯å¦è¿‡æœŸ

### ç¼“å­˜æ›´æ–°æœºåˆ¶

1. **åˆæ¬¡åŠ è½½**ï¼?   - æ£€æŸ¥ç¼“å­?â†?æ— ç¼“å­?â†?ä»æœåŠ¡å™¨åŠ è½½ â†?å†™å…¥ç¼“å­˜

2. **ç¼“å­˜æœ‰æ•ˆæœŸå†…**ï¼?   - æ£€æŸ¥ç¼“å­?â†?æœ‰æ•ˆ â†?ç«‹å³ä½¿ç”¨ç¼“å­˜æ•°æ® â†?åå°åˆ·æ–°

3. **ç¼“å­˜è¿‡æœŸ**ï¼?   - æ£€æŸ¥ç¼“å­?â†?è¿‡æœŸ â†?ä»æœåŠ¡å™¨åŠ è½½ â†?æ›´æ–°ç¼“å­˜

### ä¸ºä»€ä¹ˆé€‰æ‹© 5 åˆ†é’Ÿï¼?
- å¤ªçŸ­ï¼?1åˆ†é’Ÿï¼‰ï¼šç¼“å­˜æ•ˆæœä¸æ˜æ˜?- å¤ªé•¿ï¼?15åˆ†é’Ÿï¼‰ï¼šæ•°æ®å¯èƒ½è¿‡æ—¶
- 5åˆ†é’Ÿï¼šå¹³è¡¡æ€§èƒ½å’Œæ–°é²œåº¦çš„æœ€ä½³é€‰æ‹©

      debounceTimer = setTimeout(async () => {
        // 1ç§’åæ‰æ‰§è¡ŒåŠ è½?        const result = await getMerchants({ ... })
        setMerchants(result.merchants)
        setTotalMerchants(result.total)
      }, 1000)
    })
    .subscribe()

  return () => {
    if (debounceTimer) {
      clearTimeout(debounceTimer)
    }
    supabase.removeChannel(channel)
  }
}, [filters, currentPage, pageSize])
```

#### 3. æ·»åŠ åˆå§‹åŒ–çŠ¶æ€ï¼ˆç¬?6è¡Œï¼‰
```typescript
const [initializing, setInitializing] = useState(true) // æ·»åŠ åˆå§‹åŒ–çŠ¶æ€?```

ç”¨äºè·Ÿè¸ªåˆå§‹åŒ–å®ŒæˆçŠ¶æ€ï¼Œå¯ç”¨äºæ˜¾ç¤?loading UIã€?
#### 4. å¯¼å…¥ useMemoï¼ˆç¬¬47è¡Œï¼‰
```typescript
import { useState, useEffect, useMemo } from "react"
```

ä¸ºåç»­å¯èƒ½çš„ useMemo ä¼˜åŒ–åšå‡†å¤‡ã€?
## æ€§èƒ½å¯¹æ¯”

### ä¼˜åŒ–å‰çš„åŠ è½½æµç¨‹
```
å¼€å§? â†?(300ms) åŠ è½½æœåŠ¡ç±»å‹
 â†?(200ms) åŠ è½½ç³»ç»Ÿè®¾ç½®
 â†?(400ms) è·å–ç”¨æˆ·ä¿¡æ¯
 â†?(300ms) è·å–å•†å®¶ä¿¡æ¯
 â†?(200ms) è·å–ç”¨æˆ·ç§¯åˆ†
 â†?(300ms) è·å–å•†å®¶å¤‡æ³¨
 â†?(800ms) åŠ è½½å•†å®¶åˆ—è¡¨
å®Œæˆ (æ€»è®¡çº?2.5ç§?
```

### ä¼˜åŒ–åçš„åŠ è½½æµç¨‹
```
å¼€å§? â†?å¹¶è¡Œæ‰§è¡Œ
 â”œâ”€ (300ms) åŠ è½½æœåŠ¡ç±»å‹ â”€â”? â”œâ”€ (200ms) åŠ è½½ç³»ç»Ÿè®¾ç½® â”€â”? â””â”€ (400ms) è·å–ç”¨æˆ·ä¿¡æ¯ â”€â”? â†?(ç”¨æˆ·ä¿¡æ¯è¿”å›åå¹¶è¡Œæ‰§è¡?
 â”œâ”€ (300ms) è·å–å•†å®¶ä¿¡æ¯ â”€â”? â”œâ”€ (200ms) è·å–ç”¨æˆ·ç§¯åˆ† â”€â”? â””â”€ (300ms) è·å–å•†å®¶å¤‡æ³¨ â”€â”? â†?(800ms) åŠ è½½å•†å®¶åˆ—è¡¨
å®Œæˆ (æ€»è®¡çº?1.5ç§?
```

**èŠ‚çœæ—¶é—´ï¼šçº¦ 1 ç§’ï¼ˆ40% æå‡ï¼?*

## è¿›ä¸€æ­¥ä¼˜åŒ–å»ºè®?
### 1. ä¼˜åŒ– getMerchants å‡½æ•°ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
ä¿®æ”¹ `lib/actions/merchant.ts` ä¸­çš„ getMerchants å‡½æ•°ï¼?
```typescript
// å½“å‰ï¼šåœ¨å†…å­˜ä¸­æ’åºå’Œåˆ†é¡µ
// å»ºè®®ï¼šåœ¨æ•°æ®åº“å±‚é¢å®Œæˆ?
export async function getMerchants(filters) {
  // ä½¿ç”¨æ•°æ®åº“çš„ ORDER BY å’?LIMIT/OFFSET
  let query = supabase
    .from("merchants")
    .select("*, profiles!inner(username, avatar, user_number, points)", { count: 'exact' })
