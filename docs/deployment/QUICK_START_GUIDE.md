# 第一阶段完善 - 快速使用指南

## 🎉 恭喜！第一阶段开发已全部完成

---

## 📋 在开始使用前

### 1. 必须执行数据库脚本

请在Supabase SQL Editor中执行以下脚本：

```sql
-- 打开 scripts/010_add_merchant_views.sql 文件
-- 复制全部内容到Supabase SQL Editor
-- 点击"Run"执行
```

这个脚本会：
- 添加 `views` 字段到 merchants 表（如果不存在）
- 创建自动增加浏览量的数据库函数

**如果不执行此脚本，访问商家详情页会报错！**

---

## 🚀 新功能使用说明

### 1. 编辑商家信息（带积分确认）

**步骤**：
1. 登录账号（必须是商家用户）
2. 在首页找到自己的商家
3. 点击右侧操作菜单（三个点）
4. 点击"编辑（100积分）"
5. **弹出积分确认对话框**：
   - 显示将扣除100积分
   - 显示当前积分余额
   - 显示操作后余额
   - 如果积分不足，按钮会禁用
6. 点击"确认操作"后扣除积分
7. 自动跳转到编辑页面
8. 修改商家信息并保存

**注意**：
- 编辑操作需要100积分
- 积分会在点击"确认操作"时立即扣除
- 编辑页面会显示"已扣除100积分"的提示

---

### 2. 查看商家详情页

**步骤**：
1. 在首页点击任意商家的"查看详情"
2. 查看完整的商家信息：
   - 商家头像、名称、认证状态
   - 服务类型标签
   - 详细描述
   - 价格区间
   - 响应速度、库存状态
   - 售后保障和支付方式
   - 浏览量统计
3. 点击"收藏"按钮收藏商家
4. 点击"立即咨询"查看联系方式（需要积分）

**特性**：
- 每次访问详情页，浏览量自动+1
- 收藏状态实时显示
- 可以直接从详情页咨询

---

### 3. 收藏商家

#### 方式一：在首页收藏
1. 找到想收藏的商家
2. 点击右侧操作菜单（三个点）
3. 点击"收藏"
4. 提示"收藏成功"

#### 方式二：在详情页收藏
1. 进入商家详情页
2. 点击右上角"收藏"按钮
3. 提示"收藏成功"
4. 按钮变为"已收藏"

#### 查看收藏列表
1. 点击导航栏用户头像
2. 在下拉菜单中点击"我的收藏"
3. 查看所有收藏的商家
4. 可以点击"查看"进入详情
5. 可以点击"取消"取消收藏

---

### 4. 商家后台（商家用户专属）

**访问方式**：
1. 点击导航栏用户头像
2. 在下拉菜单中点击"商家后台"（仅商家用户可见）

**功能**：
- 查看浏览量、收藏数
- 查看置顶状态
- 编辑商家信息（不扣积分，简化版编辑）
- 置顶推广（需要积分确认）

---

### 5. 置顶推广（带积分确认）

**步骤**：
1. 进入商家后台
2. 点击"置顶推广"按钮
3. 在对话框中选择置顶天数（1-30天）
4. 系统显示需要消耗的积分（100积分/天）
5. 点击"下一步"
6. **弹出积分确认对话框**：
   - 显示将扣除的总积分
   - 显示当前积分余额
   - 显示操作后余额
   - 显示置顶时长
7. 点击"确认操作"完成置顶

**效果**：
- 置顶的商家会显示在列表顶部
- 商家名称旁边显示红色"置顶"标签
- 获得更多曝光机会

---

### 6. 查看联系方式（已有功能，现已完善）

**步骤**：
1. 在首页或详情页点击"立即咨询"
2. **弹出积分提示对话框**：
   - 客户查看商家联系方式：扣10积分
   - 商家查看商家联系方式：扣50积分
   - 显示当前积分余额
3. 点击"确认查看"
4. 显示商家的联系方式（微信、Telegram、WhatsApp、邮箱等）
5. 可以一键复制联系方式

---

## 🎯 积分使用场景总览

| 操作 | 扣除积分 | 确认对话框 |
|------|---------|-----------|
| 注册账号 | +100 | 无（自动获得） |
| 每日签到 | +5 | 无（直接获得） |
| 连续7天签到 | +20（额外） | 无（自动奖励） |
| 连续30天签到 | +50（额外） | 无（自动奖励） |
| 商家入驻 | +50 | 无（自动获得） |
| **编辑商家信息** | **-100** | **✓ 有确认** |
| **客户查看联系方式** | **-10** | **✓ 有确认** |
| **商家查看联系方式** | **-50** | **✓ 有确认** |
| **置顶推广（每天）** | **-100** | **✓ 有确认** |

---

## 🎨 新增页面路由

| 路径 | 功能 | 说明 |
|------|------|------|
| `/merchant/[id]` | 商家详情页 | 显示完整商家信息 |
| `/merchant/edit/[id]` | 商家编辑页 | 编辑商家信息（需先扣100积分） |
| `/favorites` | 收藏列表页 | 查看所有收藏的商家 |
| `/merchant/dashboard` | 商家后台 | 商家管理中心（仅商家用户） |

---

## 🔍 测试建议

### 测试账号准备
建议准备以下测试账号：

1. **客户账号**（普通用户）
   - 测试查看商家信息
   - 测试收藏功能
   - 测试查看联系方式（扣10积分）

2. **商家账号A**（有充足积分）
   - 测试编辑商家信息（扣100积分）
   - 测试置顶功能（扣N*100积分）
   - 测试查看其他商家联系方式（扣50积分）

3. **商家账号B**（积分不足）
   - 测试积分不足时的各种操作
   - 验证所有操作都被正确阻止
   - 验证错误提示是否友好

### 快速增加测试积分

如果测试时积分不足，在Supabase SQL Editor执行：

```sql
-- 给指定用户增加积分
UPDATE profiles
SET points = 10000
WHERE email = '你的测试邮箱';
```

---

## 📱 功能演示流程

### 完整用户流程演示

#### 客户用户流程：
1. 注册账号（获得100积分）
2. 每日签到（获得5积分）
3. 浏览商家列表
4. 点击查看商家详情
5. 收藏感兴趣的商家
6. 点击"立即咨询"查看联系方式（消耗10积分）
7. 查看"我的收藏"列表

#### 商家用户流程：
1. 注册账号（获得100积分）
2. 免费入驻（获得50积分）
3. 每日签到（获得5积分）
4. 查看商家后台，了解浏览量和数据
5. 编辑商家信息（消耗100积分）
6. 置顶推广商家7天（消耗700积分）
7. 查看其他商家联系方式（消耗50积分）

---

## ⚠️ 常见问题

### 1. 访问商家详情页报错
**原因**：未执行数据库脚本
**解决**：执行 `scripts/010_add_merchant_views.sql`

### 2. 点击编辑按钮后没有跳转到编辑页
**原因**：积分不足或网络问题
**解决**：检查积分余额，查看浏览器控制台错误信息

### 3. 收藏后没有显示"已收藏"
**原因**：页面没有刷新
**解决**：刷新页面或重新进入详情页

### 4. 商家后台菜单看不到
**原因**：当前账号不是商家用户
**解决**：先完成商家入驻

### 5. 置顶后没有显示在顶部
**原因**：需要刷新首页
**解决**：返回首页并刷新

---

## 🎊 下一步

第一阶段已全部完成！现在可以：

1. **充分测试所有新功能**
2. **收集用户反馈**
3. **准备进入第二阶段开发**：
   - 添加分页功能
   - 移动端响应式优化
   - 开发者工具页面

---

## 📞 技术支持

如有问题，请查看：
- `PHASE1_UPDATES.md` - 详细的技术文档
- `README.md` - 项目整体说明
- 浏览器控制台的错误信息

祝使用愉快！🎉
